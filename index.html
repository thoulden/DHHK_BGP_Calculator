<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Balanced Growth Path Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f7;
      color: #222;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      padding: 24px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    h1 {
      font-size: 1.6rem;
      margin: 0 0 8px;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 0;
    }
    .subtitle {
      color: #555;
      font-size: 0.95rem;
      margin-bottom: 16px;
    }
    .sliders {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 18px 24px;
    }
    .slider-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .slider-group label {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .value-display {
      font-size: 0.85rem;
      color: #555;
    }
    input[type="range"] {
      width: 100%;
    }
    .result-box {
      border-radius: 10px;
      padding: 12px 14px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      margin-top: 12px;
    }
    .result-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #666;
      margin-bottom: 4px;
    }
    .result-value {
      font-size: 1.3rem;
      font-weight: 700;
    }
    .ok-status {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .ok-status.ok {
      background: #e6f6ea;
      color: #1b6a32;
      border: 1px solid #b8e2c4;
    }
    .ok-status.error {
      background: #fde8e7;
      color: #b02a1c;
      border: 1px solid #f5b5af;
    }
    .footer {
      margin-top: 8px;
      font-size: 0.75rem;
      color: #777;
    }
    .checkbox-row {
      margin-top: 16px;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    @media (max-width: 600px) {
      .card {
        padding: 16px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Balanced Growth Path Calculator</h1>
      <p class="subtitle">
        Adjust the automation parameters <strong>f<sub>Y</sub></strong>, <strong>f<sub>S</sub></strong>, 
        <strong>f<sub>A</sub></strong>, <strong>f<sub>H</sub></strong>, and labor share <strong>α</strong>.<br/>
        Optionally edit the returns to research. The app computes the per-capita growth ratio
        relative to the no-automation case (with the same returns to research).
      </p>

      <!-- Automation & alpha sliders -->
      <div class="sliders">
        <div class="slider-group">
          <label for="fY">% Automation of Output Tasks (f<sub>Y</sub>)</label>
          <input type="range" id="fY" min="0" max="1" step="0.001" value="0" />
          <div class="value-display">Current: <span id="fY-value">0</span></div>
        </div>

        <div class="slider-group">
          <label for="fz">% Automation of Software Research Tasks (f<sub>z</sub>)</label>
          <input type="range" id="fz" min="0" max="1" step="0.001" value="0" />
          <div class="value-display">Current: <span id="fz-value">0</span></div>
        </div>

        <div class="slider-group">
          <label for="fA">% Automation of TFP Research Tasks (f<sub>A</sub>)</label>
          <input type="range" id="fA" min="0" max="1" step="0.001" value="0" />
          <div class="value-display">Current: <span id="fA-value">0</span></div>
        </div>

        <div class="slider-group">
          <label for="fh">% Automation of Hardware Research Tasks (f<sub>H</sub>)</label>
          <input type="range" id="fh" min="0" max="1" step="0.001" value="0" />
          <div class="value-display">Current: <span id="fh-value">0</span></div>
        </div>

        <div class="slider-group">
          <label for="alpha">Labor Share (α)</label>
          <input type="range" id="alpha" min="0.01" max="0.99" step="0.01" value="0.60" />
          <div class="value-display">Current: <span id="alpha-value">0.60</span></div>
        </div>
      </div>

      <!-- Checkbox to edit returns to research -->
      <div class="checkbox-row">
        <label>
          <input type="checkbox" id="editReturns" />
          Edit Returns to Research
        </label>
      </div>

      <!-- Returns to research sliders (hidden until checkbox is checked) -->
      <div id="returns-sliders" class="sliders" style="display:none; margin-top:8px;">
        <div class="slider-group">
          <label for="rz">Return to Software Research (r<sub>S</sub>)</label>
          <input type="range" id="rz" min="0" max="10" step="0.01" value="1.00" />
          <div class="value-display">Current: <span id="rz-value">1.00</span></div>
        </div>

        <div class="slider-group">
          <label for="rh">Return to Hardware Research (r<sub>H</sub>)</label>
          <input type="range" id="rh" min="0" max="10" step="0.01" value="5.00" />
          <div class="value-display">Current: <span id="rh-value">5.00</span></div>
        </div>

        <div class="slider-group">
          <label for="rA">Return to TFP Research (r<sub>A</sub>)</label>
          <input type="range" id="rA" min="0" max="10" step="0.01" value="0.32" />
          <div class="value-display">Current: <span id="rA-value">0.32</span></div>
        </div>
      </div>

      <div class="card" style="margin-top:18px;">
        <h2>Results</h2>
        <div id="status" class="ok-status"></div>

        <div class="result-box">
          <div class="result-title">BGP Multiplier over no automation</div>
          <div class="result-value" id="ratio">–</div>
        </div>

        <div class="footer">
          By default, returns to research are fixed at: r<sub>S</sub> = 1, r<sub>H</sub> = 5, r<sub>A</sub> = 0.32.
          Tick “Edit Returns to Research” to change them.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Base parameters (n fixed, rz/rh/rA can be edited)
    const baseParams = {
      n: 0.01,
      rz: 1,
      rh: 5,
      rA: 0.32
    };

    // Utility: 3x3 matrix inverse
    function invert3x3(m) {
      const a = m[0][0], b = m[0][1], c = m[0][2];
      const d = m[1][0], e = m[1][1], f = m[1][2];
      const g = m[2][0], h = m[2][1], i = m[2][2];

      const det =
        a * (e * i - f * h) -
        b * (d * i - f * g) +
        c * (d * h - e * g);

      if (!Number.isFinite(det) || Math.abs(det) < 1e-12) {
        return { ok: false, inv: null };
      }

      const invDet = 1 / det;

      const inv = [
        [
          (e * i - f * h) * invDet,
          (c * h - b * i) * invDet,
          (b * f - c * e) * invDet
        ],
        [
          (f * g - d * i) * invDet,
          (a * i - c * g) * invDet,
          (c * d - a * f) * invDet
        ],
        [
          (d * h - e * g) * invDet,
          (b * g - a * h) * invDet,
          (a * e - b * d) * invDet
        ]
      ];

      return { ok: true, inv };
    }

    // Utility: multiply 3x3 by 3x1
    function matVec3x3(m, v) {
      return [
        m[0][0] * v[0] + m[0][1] * v[1] + m[0][2] * v[2],
        m[1][0] * v[0] + m[1][1] * v[1] + m[1][2] * v[2],
        m[2][0] * v[0] + m[2][1] * v[1] + m[2][2] * v[2]
      ];
    }

    // Core: compute gy2 for given f's, alpha, and returns to research
    function computeGy2(fY, fz, fA, fh, alpha, params) {
      const { n, rz, rh, rA } = params;

      if (alpha <= 0 || alpha >= 1) {
        return { ok: false, value: NaN };
      }

      // --- s-matrix elements ---
      const denom_s_h = (1 - fY) - rh * fh;
      const denom_s_z = (1 - fY) - rz * fz;
      const denom_s_A = (1 - fY) * alpha - rA * fA;

      if (Math.abs(denom_s_h) < 1e-14 || Math.abs(denom_s_z) < 1e-14 || Math.abs(denom_s_A) < 1e-14) {
        return { ok: false, value: NaN };
      }

      const s_hz = rh * fh / denom_s_h;
      const s_hA = (1 / alpha) * rh * fh / denom_s_h;

      const s_zh = rz * fz / denom_s_z;
      const s_zA = (1 / alpha) * rz * fz / denom_s_z;

      const s_Ah = rA * fA / denom_s_A;
      const s_Az = rA * fA / denom_s_A;

      const F = [
        [0,     s_hz, s_hA],
        [s_zh,  0,    s_zA],
        [s_Ah,  s_Az, 0   ]
      ];

      // Psi = inv(I - F)
      const IminusF = [
        [1 - F[0][0],   -F[0][1],     -F[0][2]],
        [ -F[1][0],    1 - F[1][1],   -F[1][2]],
        [ -F[2][0],     -F[2][1],    1 - F[2][2]]
      ];

      const invRes = invert3x3(IminusF);
      if (!invRes.ok) {
        return { ok: false, value: NaN };
      }
      const Psi = invRes.inv;

      // --- r-vector elements ---
      const denom_r_common = 1 - (1 - fY) * alpha;
      const denom_rh = (rh * fh / (1 - fY)) - 1;
      const denom_rz = (rz * fz / (1 - fY)) - 1;
      const denom_rA = (rA * fA / ((1 - fY) * alpha)) - 1;

      if (
        Math.abs(denom_r_common) < 1e-14 ||
        Math.abs(denom_rh) < 1e-14 ||
        Math.abs(denom_rz) < 1e-14 ||
        Math.abs(denom_rA) < 1e-14
      ) {
        return { ok: false, value: NaN };
      }

      const r_hL = -(rh * (1 - fh) * (1 - fY) * alpha / denom_r_common) / denom_rh;
      const r_zL = -(rz * (1 - fz) * (1 - fY) * alpha / denom_r_common) / denom_rz;
      const r_AL = -(rA * (1 - fA) * (1 - fY) * alpha / (1 - (1 - fA) * alpha)) / denom_rA;

      if (
        !Number.isFinite(r_hL) ||
        !Number.isFinite(r_zL) ||
        !Number.isFinite(r_AL)
      ) {
        return { ok: false, value: NaN };
      }

      const rVec = [r_hL, r_zL, r_AL];
      const N = [n, n, n];

      const r_circle_n = [
        rVec[0] * N[0],
        rVec[1] * N[1],
        rVec[2] * N[2]
      ];

      const g_A_BGP = matVec3x3(Psi, r_circle_n);

      if (!g_A_BGP.every(Number.isFinite)) {
        return { ok: false, value: NaN };
      }

      const gY2 = g_A_BGP[2] * (1 / alpha) +
                  (1 - fY) * n +
                  fY * (g_A_BGP[0] + g_A_BGP[1]);

      const gy2 = gY2 - n;

      if (!Number.isFinite(gy2)) {
        return { ok: false, value: NaN };
      }

      return { ok: true, value: gy2 };
    }

    // Hook up UI
    const sliders = ["fY", "fz", "fA", "fh", "alpha", "rz", "rh", "rA"];
    const values = {
      fY: document.getElementById("fY-value"),
      fz: document.getElementById("fz-value"),
      fA: document.getElementById("fA-value"),
      fh: document.getElementById("fh-value"),
      alpha: document.getElementById("alpha-value"),
      rz: document.getElementById("rz-value"),
      rh: document.getElementById("rh-value"),
      rA: document.getElementById("rA-value")
    };

    const ratioSpan = document.getElementById("ratio");
    const statusDiv = document.getElementById("status");
    const editReturnsCheckbox = document.getElementById("editReturns");
    const returnsSlidersDiv = document.getElementById("returns-sliders");

    function update() {
      const fY = parseFloat(document.getElementById("fY").value);
      const fz = parseFloat(document.getElementById("fz").value);
      const fA = parseFloat(document.getElementById("fA").value);
      const fh = parseFloat(document.getElementById("fh").value);
      const alpha = parseFloat(document.getElementById("alpha").value);

      // Update displayed numeric values for automation & alpha
      values.fY.textContent = fY.toFixed(3);
      values.fz.textContent = fz.toFixed(3);
      values.fA.textContent = fA.toFixed(3);
      values.fh.textContent = fh.toFixed(3);
      values.alpha.textContent = alpha.toFixed(2);

      // Decide which returns to research to use
      const editReturns = editReturnsCheckbox.checked;
      let rz = baseParams.rz;
      let rh = baseParams.rh;
      let rA = baseParams.rA;

      if (editReturns) {
        rz = parseFloat(document.getElementById("rz").value);
        rh = parseFloat(document.getElementById("rh").value);
        rA = parseFloat(document.getElementById("rA").value);

        values.rz.textContent = rz.toFixed(2);
        values.rh.textContent = rh.toFixed(2);
        values.rA.textContent = rA.toFixed(2);
      }

      const paramSet = {
        n: baseParams.n,
        rz,
        rh,
        rA
      };

      // Compute gy2 for current f's
      const resCurrent = computeGy2(fY, fz, fA, fh, alpha, paramSet);
      // Compute gy2 for all f = 0 (benchmark), same r's and alpha
      const resZero = computeGy2(0, 0, 0, 0, alpha, paramSet);

      let ratioOk = resCurrent.ok && resZero.ok && resZero.value !== 0 &&
                    Number.isFinite(resZero.value) && Number.isFinite(resCurrent.value);

      if (!ratioOk) {
        statusDiv.textContent = "System Explodes (no BGP)";
        statusDiv.className = "ok-status error";
        ratioSpan.textContent = "–";
        return;
      }

      const ratio = resCurrent.value / resZero.value;

      if (!Number.isFinite(ratio)) {
        statusDiv.textContent = "System Explodes (no BGP)";
        statusDiv.className = "ok-status error";
        ratioSpan.textContent = "–";
        return;
      }

      if (ratio < 0) {
        // Negative ratio => explosive dynamics
        statusDiv.textContent = "System has explosive dynamics (no BGP)";
        statusDiv.className = "ok-status error";
        ratioSpan.textContent = "-";
      } else {
        statusDiv.textContent = "System has a Balanced Growth Path.";
        statusDiv.className = "ok-status ok";
        ratioSpan.textContent = ratio.toFixed(4) + " ×";
      }
    }

    // Attach listeners
    sliders.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("input", update);
      }
    });

    editReturnsCheckbox.addEventListener("change", () => {
      returnsSlidersDiv.style.display = editReturnsCheckbox.checked ? "grid" : "none";
      update();
    });

    // Initial computation
    update();
  </script>
</body>
</html>


